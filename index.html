<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Acre MQTT Monitoring</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  </head>
  <body>
    <header class="topbar">
      <h1>Acre MQTT Monitoring</h1>
      <p>Lecture MQTT temps réel, plugins ACRE par topic et mur vidéo RTSP auto-transcodé.</p>
    </header>

    <main class="layout">
      <nav class="tabs" aria-label="Navigation">
        <button class="tab active" data-tab="dashboard">Dashboard</button>
        <button class="tab" data-tab="mqtt">Serveurs MQTT</button>
        <button class="tab" data-tab="plugins">Plugins</button>
        <button class="tab" data-tab="video">Mur vidéo</button>
      </nav>

      <section id="dashboard" class="tab-panel active">
        <h2>État global</h2>
        <div class="card-grid" id="summaryGrid"></div>

        <h3>Données décodées ACRE</h3>
        <div class="card-grid" id="decodedGrid"></div>

        <h3>Topics MQTT reçus</h3>
        <div class="card-grid" id="dataGrid"></div>
      </section>

      <section id="mqtt" class="tab-panel">
        <h2>Configuration serveurs MQTT</h2>
        <form id="mqttForm" class="card form-card wide">
          <label>Nom serveur<input name="name" placeholder="Broker principal" required /></label>
          <label>URL WebSocket<input name="wsUrl" placeholder="ws://192.168.1.10:9001" required /></label>
          <label>Utilisateur<input name="username" placeholder="optionnel" /></label>
          <label>Mot de passe<input name="password" type="password" placeholder="optionnel" /></label>
          <button type="submit">Ajouter serveur</button>
        </form>

        <div class="card-grid" id="mqttServersGrid"></div>

        <article class="card">
          <h3>Importer un snapshot topics MQTT (JSON topic->payload)</h3>
          <textarea id="snapshotInput" rows="10" class="mono" placeholder='{"acre_indus/zones/1/name":"1 IR Escalier RJS"}'></textarea>
          <div class="row-actions">
            <button id="loadSnapshotBtn" type="button">Charger snapshot</button>
            <button id="loadDemoBtn" type="button" class="secondary">Charger démo</button>
            <button id="clearTopicsBtn" type="button" class="danger">Vider topics</button>
          </div>
        </article>
      </section>

      <section id="plugins" class="tab-panel">
        <h2>Plugins</h2>
        <form id="pluginForm" class="card form-card wide">
          <label>
            Type
            <select name="type" required>
              <option value="ACRE">ACRE</option>
              <option value="Custom">Custom</option>
            </select>
          </label>
          <label>Nom plugin<input name="name" placeholder="Acre Indus" required /></label>
          <label>Serveur MQTT<select name="serverId" id="pluginServerSelect"></select></label>
          <label>Topic root<input name="topicRoot" placeholder="acre_indus" required /></label>
          <button type="submit">Ajouter plugin</button>
        </form>
        <div class="card-grid" id="pluginsGrid"></div>
      </section>

      <section id="video" class="tab-panel">
        <h2>Mur d'image RTSP</h2>

        <article class="card">
          <h3>Passerelle locale RTSP ➜ HLS</h3>
          <p class="meta">API locale (par défaut <code>http://127.0.0.1:8787</code>) utilisée pour transcoder automatiquement les flux RTSP pour le navigateur.</p>
          <label>URL API passerelle<input id="gatewayApiInput" placeholder="http://127.0.0.1:8787" /></label>
        </article>

        <form id="cameraForm" class="card form-card wide">
          <label>Nom caméra<input name="name" placeholder="Caméra Entrée" required /></label>
          <label>URL RTSP<input name="rtspUrl" placeholder="rtsp://user:pass@ip:554/stream1" required /></label>
          <label>URL web manuelle (optionnel)<input name="webUrl" placeholder="https://.../index.m3u8" /></label>
          <button type="submit">Ajouter caméra</button>
        </form>

        <div class="camera-wall" id="cameraWall"></div>
      </section>
    </main>

    <template id="simpleCardTemplate">
      <article class="card">
        <header>
          <h3 class="title"></h3>
          <span class="badge"></span>
        </header>
        <p class="meta"></p>
      </article>
    </template>

    <script src="app.js"></script>
  </body>
</html>
